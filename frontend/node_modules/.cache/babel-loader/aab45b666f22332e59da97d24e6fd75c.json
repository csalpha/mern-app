{"ast":null,"code":"import _asyncToGenerator from\"/home/carlos/Documents/GitHub/mern-ecommerce/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/carlos/Documents/GitHub/mern-ecommerce/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/home/carlos/Documents/GitHub/mern-ecommerce/frontend/node_modules/@babel/runtime/regenerator/index.js\";import React,{useContext,useEffect,useRef,useState}from'react';import{LoadScript,GoogleMap,StandaloneSearchBox,Marker}from'@react-google-maps/api';import Button from'react-bootstrap/Button';import LoadingBox from'../components/LoadingBox';import Axios from'axios';import{useNavigate}from'react-router-dom';import{Store}from'../Store';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var libs=['places'];var defaultLocation={lat:45.516,lng:-73.56};export default function MapScreen(){var _useContext=useContext(Store),state=_useContext.state,ctxDispatch=_useContext.dispatch;var userInfo=state.userInfo;var navigate=useNavigate();var _useState=useState(''),_useState2=_slicedToArray(_useState,2),googleApiKey=_useState2[0],setGoogleApiKey=_useState2[1];var _useState3=useState(defaultLocation),_useState4=_slicedToArray(_useState3,2),center=_useState4[0],setCenter=_useState4[1];var _useState5=useState(center),_useState6=_slicedToArray(_useState5,2),location=_useState6[0],setLocation=_useState6[1];var mapRef=useRef(null);var placeRef=useRef(null);var markerRef=useRef(null);useEffect(function(){var fetch=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$Axios,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return Axios('/api/config/google');case 2:_yield$Axios=_context.sent;data=_yield$Axios.data;setGoogleApiKey(data);getUserCurrentLocation();case 6:case\"end\":return _context.stop();}}},_callee);}));return function fetch(){return _ref.apply(this,arguments);};}();fetch();},[]);var onLoad=function onLoad(map){mapRef.current=map;};var onMarkerLoad=function onMarkerLoad(marker){markerRef.current=marker;};var onLoadPlaces=function onLoadPlaces(place){placeRef.current=place;};var onIdle=function onIdle(){setLocation({lat:mapRef.current.center.lat(),lng:mapRef.current.center.lng()});};var onPlacesChanged=function onPlacesChanged(){var place=placeRef.current.getPlaces()[0].geometry.location;setCenter({lat:place.lat(),lng:place.lng()});setLocation({lat:place.lat(),lng:place.lng()});};var onConfirm=function onConfirm(){var places=placeRef.current.getPlaces();if(places&&places.length===1){// dispatch select action\n// ctxDispatch({\n//   type: USER_ADDRESS_MAP_CONFIRM,\n//   payload: {\n//     lat: location.lat,\n//     lng: location.lng,\n//     address: places[0].formatted_address,\n//     name: places[0].name,\n//     vicinity: places[0].vicinity,\n//     googleAddressId: places[0].id,\n//   },\n// });\nalert('location selected successfully.');navigate('/shipping');}else{alert('Please enter your address');}};var getUserCurrentLocation=function getUserCurrentLocation(){if(!navigator.geolocation){alert('Geolocation os not supported by this browser');}else{navigator.geolocation.getCurrentPosition(function(position){setCenter({lat:position.coords.latitude,lng:position.coords.longitude});setLocation({lat:position.coords.latitude,lng:position.coords.longitude});});}};return googleApiKey?/*#__PURE__*/_jsx(\"div\",{className:\"full-container\",children:/*#__PURE__*/_jsx(LoadScript,{libraries:libs,googleMapsApiKey:googleApiKey,children:/*#__PURE__*/_jsxs(GoogleMap,{id:\"smaple-map\",mapContainerStyle:{height:'100%',width:'100%'},center:center,zoom:15,onLoad:onLoad,onIdle:onIdle,children:[/*#__PURE__*/_jsx(StandaloneSearchBox,{onLoad:onLoadPlaces,onPlacesChanged:onPlacesChanged,children:/*#__PURE__*/_jsxs(\"div\",{className:\"map-input-box\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Enter your address\"}),/*#__PURE__*/_jsx(Button,{type:\"button\",onClick:onConfirm,children:\"Confirm\"})]})}),/*#__PURE__*/_jsx(Marker,{position:location,onLoad:onMarkerLoad})]})})}):/*#__PURE__*/_jsx(LoadingBox,{});}","map":{"version":3,"sources":["/home/carlos/Documents/GitHub/mern-ecommerce/frontend/src/screens/MapScreen.js"],"names":["React","useContext","useEffect","useRef","useState","LoadScript","GoogleMap","StandaloneSearchBox","Marker","Button","LoadingBox","Axios","useNavigate","Store","libs","defaultLocation","lat","lng","MapScreen","state","ctxDispatch","dispatch","userInfo","navigate","googleApiKey","setGoogleApiKey","center","setCenter","location","setLocation","mapRef","placeRef","markerRef","fetch","data","getUserCurrentLocation","onLoad","map","current","onMarkerLoad","marker","onLoadPlaces","place","onIdle","onPlacesChanged","getPlaces","geometry","onConfirm","places","length","alert","navigator","geolocation","getCurrentPosition","position","coords","latitude","longitude","height","width"],"mappings":"oaAAA,MAAOA,CAAAA,KAAP,EAAgBC,UAAhB,CAA4BC,SAA5B,CAAuCC,MAAvC,CAA+CC,QAA/C,KAA+D,OAA/D,CACA,OACEC,UADF,CAEEC,SAFF,CAGEC,mBAHF,CAIEC,MAJF,KAKO,wBALP,CAMA,MAAOC,CAAAA,MAAP,KAAmB,wBAAnB,CACA,MAAOC,CAAAA,UAAP,KAAuB,0BAAvB,CACA,MAAOC,CAAAA,KAAP,KAAkB,OAAlB,CAEA,OAASC,WAAT,KAA4B,kBAA5B,CACA,OAASC,KAAT,KAAsB,UAAtB,C,wFAEA,GAAMC,CAAAA,IAAI,CAAG,CAAC,QAAD,CAAb,CACA,GAAMC,CAAAA,eAAe,CAAG,CAAEC,GAAG,CAAE,MAAP,CAAeC,GAAG,CAAE,CAAC,KAArB,CAAxB,CAEA,cAAe,SAASC,CAAAA,SAAT,EAAqB,CAClC,gBAAyCjB,UAAU,CAACY,KAAD,CAAnD,CAAQM,KAAR,aAAQA,KAAR,CAAyBC,WAAzB,aAAeC,QAAf,CACA,GAAQC,CAAAA,QAAR,CAAqBH,KAArB,CAAQG,QAAR,CACA,GAAMC,CAAAA,QAAQ,CAAGX,WAAW,EAA5B,CACA,cAAwCR,QAAQ,CAAC,EAAD,CAAhD,wCAAOoB,YAAP,eAAqBC,eAArB,eACA,eAA4BrB,QAAQ,CAACW,eAAD,CAApC,yCAAOW,MAAP,eAAeC,SAAf,eACA,eAAgCvB,QAAQ,CAACsB,MAAD,CAAxC,yCAAOE,QAAP,eAAiBC,WAAjB,eAEA,GAAMC,CAAAA,MAAM,CAAG3B,MAAM,CAAC,IAAD,CAArB,CACA,GAAM4B,CAAAA,QAAQ,CAAG5B,MAAM,CAAC,IAAD,CAAvB,CACA,GAAM6B,CAAAA,SAAS,CAAG7B,MAAM,CAAC,IAAD,CAAxB,CAEAD,SAAS,CAAC,UAAM,CACd,GAAM+B,CAAAA,KAAK,0FAAG,+KACWtB,CAAAA,KAAK,CAAC,oBAAD,CADhB,mCACJuB,IADI,cACJA,IADI,CAEZT,eAAe,CAACS,IAAD,CAAf,CACAC,sBAAsB,GAHV,sDAAH,kBAALF,CAAAA,KAAK,0CAAX,CAKAA,KAAK,GACN,CAPQ,CAON,EAPM,CAAT,CASA,GAAMG,CAAAA,MAAM,CAAG,QAATA,CAAAA,MAAS,CAACC,GAAD,CAAS,CACtBP,MAAM,CAACQ,OAAP,CAAiBD,GAAjB,CACD,CAFD,CAIA,GAAME,CAAAA,YAAY,CAAG,QAAfA,CAAAA,YAAe,CAACC,MAAD,CAAY,CAC/BR,SAAS,CAACM,OAAV,CAAoBE,MAApB,CACD,CAFD,CAGA,GAAMC,CAAAA,YAAY,CAAG,QAAfA,CAAAA,YAAe,CAACC,KAAD,CAAW,CAC9BX,QAAQ,CAACO,OAAT,CAAmBI,KAAnB,CACD,CAFD,CAGA,GAAMC,CAAAA,MAAM,CAAG,QAATA,CAAAA,MAAS,EAAM,CACnBd,WAAW,CAAC,CACVb,GAAG,CAAEc,MAAM,CAACQ,OAAP,CAAeZ,MAAf,CAAsBV,GAAtB,EADK,CAEVC,GAAG,CAAEa,MAAM,CAACQ,OAAP,CAAeZ,MAAf,CAAsBT,GAAtB,EAFK,CAAD,CAAX,CAID,CALD,CAMA,GAAM2B,CAAAA,eAAe,CAAG,QAAlBA,CAAAA,eAAkB,EAAM,CAC5B,GAAMF,CAAAA,KAAK,CAAGX,QAAQ,CAACO,OAAT,CAAiBO,SAAjB,GAA6B,CAA7B,EAAgCC,QAAhC,CAAyClB,QAAvD,CACAD,SAAS,CAAC,CAAEX,GAAG,CAAE0B,KAAK,CAAC1B,GAAN,EAAP,CAAoBC,GAAG,CAAEyB,KAAK,CAACzB,GAAN,EAAzB,CAAD,CAAT,CACAY,WAAW,CAAC,CAAEb,GAAG,CAAE0B,KAAK,CAAC1B,GAAN,EAAP,CAAoBC,GAAG,CAAEyB,KAAK,CAACzB,GAAN,EAAzB,CAAD,CAAX,CACD,CAJD,CAMA,GAAM8B,CAAAA,SAAS,CAAG,QAAZA,CAAAA,SAAY,EAAM,CACtB,GAAMC,CAAAA,MAAM,CAAGjB,QAAQ,CAACO,OAAT,CAAiBO,SAAjB,EAAf,CACA,GAAIG,MAAM,EAAIA,MAAM,CAACC,MAAP,GAAkB,CAAhC,CAAmC,CACjC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAC,KAAK,CAAC,iCAAD,CAAL,CACA3B,QAAQ,CAAC,WAAD,CAAR,CACD,CAfD,IAeO,CACL2B,KAAK,CAAC,2BAAD,CAAL,CACD,CACF,CApBD,CAsBA,GAAMf,CAAAA,sBAAsB,CAAG,QAAzBA,CAAAA,sBAAyB,EAAM,CACnC,GAAI,CAACgB,SAAS,CAACC,WAAf,CAA4B,CAC1BF,KAAK,CAAC,8CAAD,CAAL,CACD,CAFD,IAEO,CACLC,SAAS,CAACC,WAAV,CAAsBC,kBAAtB,CAAyC,SAACC,QAAD,CAAc,CACrD3B,SAAS,CAAC,CACRX,GAAG,CAAEsC,QAAQ,CAACC,MAAT,CAAgBC,QADb,CAERvC,GAAG,CAAEqC,QAAQ,CAACC,MAAT,CAAgBE,SAFb,CAAD,CAAT,CAIA5B,WAAW,CAAC,CACVb,GAAG,CAAEsC,QAAQ,CAACC,MAAT,CAAgBC,QADX,CAEVvC,GAAG,CAAEqC,QAAQ,CAACC,MAAT,CAAgBE,SAFX,CAAD,CAAX,CAID,CATD,EAUD,CACF,CAfD,CAiBA,MAAOjC,CAAAA,YAAY,cACjB,YAAK,SAAS,CAAC,gBAAf,uBACE,KAAC,UAAD,EAAY,SAAS,CAAEV,IAAvB,CAA6B,gBAAgB,CAAEU,YAA/C,uBACE,MAAC,SAAD,EACE,EAAE,CAAC,YADL,CAEE,iBAAiB,CAAE,CAAEkC,MAAM,CAAE,MAAV,CAAkBC,KAAK,CAAE,MAAzB,CAFrB,CAGE,MAAM,CAAEjC,MAHV,CAIE,IAAI,CAAE,EAJR,CAKE,MAAM,CAAEU,MALV,CAME,MAAM,CAAEO,MANV,wBAQE,KAAC,mBAAD,EACE,MAAM,CAAEF,YADV,CAEE,eAAe,CAAEG,eAFnB,uBAIE,aAAK,SAAS,CAAC,eAAf,wBACE,cAAO,IAAI,CAAC,MAAZ,CAAmB,WAAW,CAAC,oBAA/B,EADF,cAEE,KAAC,MAAD,EAAQ,IAAI,CAAC,QAAb,CAAsB,OAAO,CAAEG,SAA/B,qBAFF,GAJF,EARF,cAmBE,KAAC,MAAD,EAAQ,QAAQ,CAAEnB,QAAlB,CAA4B,MAAM,CAAEW,YAApC,EAnBF,GADF,EADF,EADiB,cA2BjB,KAAC,UAAD,IA3BF,CA6BD","sourcesContent":["import React, { useContext, useEffect, useRef, useState } from 'react';\nimport {\n  LoadScript,\n  GoogleMap,\n  StandaloneSearchBox,\n  Marker,\n} from '@react-google-maps/api';\nimport Button from 'react-bootstrap/Button';\nimport LoadingBox from '../components/LoadingBox';\nimport Axios from 'axios';\n\nimport { useNavigate } from 'react-router-dom';\nimport { Store } from '../Store';\n\nconst libs = ['places'];\nconst defaultLocation = { lat: 45.516, lng: -73.56 };\n\nexport default function MapScreen() {\n  const { state, dispatch: ctxDispatch } = useContext(Store);\n  const { userInfo } = state;\n  const navigate = useNavigate();\n  const [googleApiKey, setGoogleApiKey] = useState('');\n  const [center, setCenter] = useState(defaultLocation);\n  const [location, setLocation] = useState(center);\n\n  const mapRef = useRef(null);\n  const placeRef = useRef(null);\n  const markerRef = useRef(null);\n\n  useEffect(() => {\n    const fetch = async () => {\n      const { data } = await Axios('/api/config/google');\n      setGoogleApiKey(data);\n      getUserCurrentLocation();\n    };\n    fetch();\n  }, []);\n\n  const onLoad = (map) => {\n    mapRef.current = map;\n  };\n\n  const onMarkerLoad = (marker) => {\n    markerRef.current = marker;\n  };\n  const onLoadPlaces = (place) => {\n    placeRef.current = place;\n  };\n  const onIdle = () => {\n    setLocation({\n      lat: mapRef.current.center.lat(),\n      lng: mapRef.current.center.lng(),\n    });\n  };\n  const onPlacesChanged = () => {\n    const place = placeRef.current.getPlaces()[0].geometry.location;\n    setCenter({ lat: place.lat(), lng: place.lng() });\n    setLocation({ lat: place.lat(), lng: place.lng() });\n  };\n\n  const onConfirm = () => {\n    const places = placeRef.current.getPlaces();\n    if (places && places.length === 1) {\n      // dispatch select action\n      // ctxDispatch({\n      //   type: USER_ADDRESS_MAP_CONFIRM,\n      //   payload: {\n      //     lat: location.lat,\n      //     lng: location.lng,\n      //     address: places[0].formatted_address,\n      //     name: places[0].name,\n      //     vicinity: places[0].vicinity,\n      //     googleAddressId: places[0].id,\n      //   },\n      // });\n      alert('location selected successfully.');\n      navigate('/shipping');\n    } else {\n      alert('Please enter your address');\n    }\n  };\n\n  const getUserCurrentLocation = () => {\n    if (!navigator.geolocation) {\n      alert('Geolocation os not supported by this browser');\n    } else {\n      navigator.geolocation.getCurrentPosition((position) => {\n        setCenter({\n          lat: position.coords.latitude,\n          lng: position.coords.longitude,\n        });\n        setLocation({\n          lat: position.coords.latitude,\n          lng: position.coords.longitude,\n        });\n      });\n    }\n  };\n\n  return googleApiKey ? (\n    <div className=\"full-container\">\n      <LoadScript libraries={libs} googleMapsApiKey={googleApiKey}>\n        <GoogleMap\n          id=\"smaple-map\"\n          mapContainerStyle={{ height: '100%', width: '100%' }}\n          center={center}\n          zoom={15}\n          onLoad={onLoad}\n          onIdle={onIdle}\n        >\n          <StandaloneSearchBox\n            onLoad={onLoadPlaces}\n            onPlacesChanged={onPlacesChanged}\n          >\n            <div className=\"map-input-box\">\n              <input type=\"text\" placeholder=\"Enter your address\"></input>\n              <Button type=\"button\" onClick={onConfirm}>\n                Confirm\n              </Button>\n            </div>\n          </StandaloneSearchBox>\n          <Marker position={location} onLoad={onMarkerLoad}></Marker>\n        </GoogleMap>\n      </LoadScript>\n    </div>\n  ) : (\n    <LoadingBox></LoadingBox>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}