{"ast":null,"code":"import _asyncToGenerator from\"/home/carlos/Documents/GitHub/mern-ecommerce/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/carlos/Documents/GitHub/mern-ecommerce/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _objectSpread from\"/home/carlos/Documents/GitHub/mern-ecommerce/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _regeneratorRuntime from\"/home/carlos/Documents/GitHub/mern-ecommerce/frontend/node_modules/@babel/runtime/regenerator/index.js\";import Axios from'axios';import React,{useContext,useEffect,useReducer,useRef,useState}from'react';import Button from'react-bootstrap/Button';import Form from'react-bootstrap/Form';import FloatingLabel from'react-bootstrap/FloatingLabel';import Row from'react-bootstrap/Row';import Col from'react-bootstrap/Col';import Card from'react-bootstrap/Card';import ListGroup from'react-bootstrap/ListGroup';import{Link,useNavigate,useParams}from'react-router-dom';import{toast}from'react-toastify';import LoadingBox from'../components/LoadingBox';import MessageBox from'../components/MessageBox';import Rating from'../components/Rating';import{Store}from'../Store';import{getError}from'../utils';import{Helmet}from'react-helmet-async';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var reducer=function reducer(state,action){switch(action.type){case'REFRESH_PRODUCT':return _objectSpread(_objectSpread({},state),{},{product:action.payload});case'FETCH_REQUEST':return _objectSpread(_objectSpread({},state),{},{loading:true});case'FETCH_SUCCESS':return _objectSpread(_objectSpread({},state),{},{product:action.payload,loading:false});case'FETCH_FAIL':return _objectSpread(_objectSpread({},state),{},{loading:false,error:action.payload});case'CREATE_REQUEST':return _objectSpread(_objectSpread({},state),{},{loadingCreateReview:true});case'CREATE_SUCCESS':return _objectSpread(_objectSpread({},state),{},{loadingCreateReview:false});case'CREATE_FAIL':return _objectSpread(_objectSpread({},state),{},{loadingCreateReview:false});default:return state;}};export default function ProductScreen(){var reviewsRef=useRef();// to add a item to the cart, i need to dispatch an action on the react context\n// Get the context\n// Rename dispatch to 'ctxDispatch' - context dispatch\n// by using useContext we can have access to the state of the context\n// and change the context\nvar _useContext=useContext(Store),state=_useContext.state,ctxDispatch=_useContext.dispatch;var cart=state.cart,userInfo=state.userInfo;var _useReducer=useReducer(reducer,{loading:true,error:''}),_useReducer2=_slicedToArray(_useReducer,2),_useReducer2$=_useReducer2[0],loading=_useReducer2$.loading,error=_useReducer2$.error,product=_useReducer2$.product,loadingCreateReview=_useReducer2$.loadingCreateReview,dispatch=_useReducer2[1];var navigate=useNavigate();var params=useParams();var slug=params.id;var _useState=useState(0),_useState2=_slicedToArray(_useState,2),rating=_useState2[0],setRating=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),comment=_useState4[0],setComment=_useState4[1];useEffect(function(){var fetchData=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$Axios$get,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:dispatch({type:'FETCH_REQUEST'});_context.prev=1;_context.next=4;return Axios.get(\"/api/products/slug/\".concat(slug));case 4:_yield$Axios$get=_context.sent;data=_yield$Axios$get.data;dispatch({type:'FETCH_SUCCESS',payload:data});_context.next=12;break;case 9:_context.prev=9;_context.t0=_context[\"catch\"](1);dispatch({type:'FETCH_FAIL',payload:getError(_context.t0)});case 12:case\"end\":return _context.stop();}}},_callee,null,[[1,9]]);}));return function fetchData(){return _ref.apply(this,arguments);};}();fetchData();},[dispatch,slug]);// add item to the cart\nvar addToCartHandler=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var existItem,quantity,_yield$Axios$get2,data;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:// exist item\nexistItem=cart.cartItems.find(function(x){return x._id===product._id;});// quantity\nquantity=existItem?existItem.quantity+1:1;// ajax request to get data product\n_context2.next=4;return Axios.get(\"/api/products/\".concat(product._id));case 4:_yield$Axios$get2=_context2.sent;data=_yield$Axios$get2.data;if(!(data.countInStock<quantity)){_context2.next=9;break;}window.alert('Sorry. Product is out of stock');return _context2.abrupt(\"return\");case 9:// dispatch action \n// payload - pass the product and the quantity\nctxDispatch({type:'CART_ADD_ITEM',payload:_objectSpread(_objectSpread({},product),{},{quantity:quantity})});navigate('/cart');case 11:case\"end\":return _context2.stop();}}},_callee2);}));return function addToCartHandler(){return _ref2.apply(this,arguments);};}();var submitHandler=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(e){var _yield$Axios$post,data;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:e.preventDefault();if(!(!comment||!rating)){_context3.next=4;break;}toast.error('Please enter comment and rating');return _context3.abrupt(\"return\");case 4:dispatch({type:'CREATE_REQUEST'});_context3.prev=5;_context3.next=8;return Axios.post(\"/api/products/\".concat(product._id,\"/reviews\"),{rating:rating,comment:comment,name:userInfo.name},{headers:{Authorization:\"Bearer \".concat(userInfo.token)}});case 8:_yield$Axios$post=_context3.sent;data=_yield$Axios$post.data;dispatch({type:'CREATE_SUCCESS'});toast.success('Review submitted successfully');product.reviews.unshift(data.review);product.numReviews=data.numReviews;product.rating=data.rating;dispatch({type:'REFRESH_PRODUCT',payload:product});window.scrollTo({behavior:'smooth',top:reviewsRef.current.offsetTop});_context3.next=23;break;case 19:_context3.prev=19;_context3.t0=_context3[\"catch\"](5);toast.error(getError(_context3.t0));dispatch({type:'CREATE_FAIL'});case 23:case\"end\":return _context3.stop();}}},_callee3,null,[[5,19]]);}));return function submitHandler(_x){return _ref3.apply(this,arguments);};}();return loading?/*#__PURE__*/_jsx(LoadingBox,{}):error?/*#__PURE__*/_jsx(MessageBox,{variant:\"danger\",children:error}):/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{md:6,children:/*#__PURE__*/_jsx(\"img\",{className:\"img-large\",src:product.image,alt:product.name})}),/*#__PURE__*/_jsx(Col,{md:3,children:/*#__PURE__*/_jsxs(ListGroup,{variant:\"flush\",children:[/*#__PURE__*/_jsxs(ListGroup.Item,{children:[/*#__PURE__*/_jsx(Helmet,{children:/*#__PURE__*/_jsx(\"title\",{children:product.name})}),/*#__PURE__*/_jsx(\"h1\",{children:product.name})]}),/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsx(Rating,{rating:product.rating,numReviews:product.numReviews})}),/*#__PURE__*/_jsxs(ListGroup.Item,{children:[\"Pirce : $\",product.price]}),/*#__PURE__*/_jsxs(ListGroup.Item,{children:[\"Description:\",/*#__PURE__*/_jsx(\"p\",{children:product.description})]})]})}),/*#__PURE__*/_jsx(Col,{md:3,children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(Card.Body,{children:/*#__PURE__*/_jsxs(ListGroup,{variant:\"flush\",children:[/*#__PURE__*/_jsxs(ListGroup.Item,{children:[\"Seller\",' ',/*#__PURE__*/_jsx(\"h2\",{children:/*#__PURE__*/_jsx(Link,{to:\"/seller/\".concat(product.seller._id),children:product.seller.seller.name})}),/*#__PURE__*/_jsx(Rating,{rating:product.seller.seller.rating,numReviews:product.seller.seller.numReviews})]}),/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{children:\"Pirce:\"}),/*#__PURE__*/_jsxs(Col,{children:[\"$\",product.price]})]})}),/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{children:\"Status:\"}),/*#__PURE__*/_jsx(Col,{children:product.countInStock>0?/*#__PURE__*/_jsx(\"span\",{className:\"success\",children:\"In Stock\"}):/*#__PURE__*/_jsx(\"span\",{className:\"danger\",children:\"Unavailable\"})})]})}),product.countInStock>0&&/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsx(\"div\",{className:\"d-grid\",children:/*#__PURE__*/_jsx(Button,{onClick:addToCartHandler,variant:\"primary\",children:\"Add to Cart\"})})})]})})})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"my-3\",children:[/*#__PURE__*/_jsx(\"h2\",{ref:reviewsRef,children:\"Reviews\"}),/*#__PURE__*/_jsx(\"div\",{className:\"mb-3\",children:product.reviews.length===0&&/*#__PURE__*/_jsx(MessageBox,{children:\"There is no review\"})}),/*#__PURE__*/_jsx(ListGroup,{children:product.reviews.map(function(review){return/*#__PURE__*/_jsxs(ListGroup.Item,{children:[/*#__PURE__*/_jsx(\"strong\",{children:review.name}),/*#__PURE__*/_jsx(Rating,{rating:review.rating,caption:\" \"}),/*#__PURE__*/_jsx(\"p\",{children:review.createdAt.substring(0,10)}),/*#__PURE__*/_jsx(\"p\",{children:review.comment})]},review._id);})}),/*#__PURE__*/_jsx(\"div\",{className:\"my-3\",children:userInfo?/*#__PURE__*/_jsxs(\"form\",{onSubmit:submitHandler,children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Write a customer review\"}),/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",controlId:\"rating\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Rating\"}),/*#__PURE__*/_jsxs(Form.Select,{\"aria-label\":\"Rating\",value:rating,onChange:function onChange(e){return setRating(e.target.value);},children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Select...\"}),/*#__PURE__*/_jsx(\"option\",{value:\"1\",children:\"1- Poor\"}),/*#__PURE__*/_jsx(\"option\",{value:\"2\",children:\"2- Fair\"}),/*#__PURE__*/_jsx(\"option\",{value:\"3\",children:\"3- Good\"}),/*#__PURE__*/_jsx(\"option\",{value:\"4\",children:\"4- Very good\"}),/*#__PURE__*/_jsx(\"option\",{value:\"5\",children:\"5- Excelent\"})]})]}),/*#__PURE__*/_jsx(FloatingLabel,{controlId:\"floatingTextarea\",label:\"Comments\",className:\"mb-3\",children:/*#__PURE__*/_jsx(Form.Control,{as:\"textarea\",placeholder:\"Leave a comment here\",value:comment,onChange:function onChange(e){return setComment(e.target.value);}})}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Button,{disabled:loadingCreateReview,type:\"submit\",children:\"Submit\"}),loadingCreateReview&&/*#__PURE__*/_jsx(LoadingBox,{})]})]}):/*#__PURE__*/_jsxs(MessageBox,{children:[\"Please \",/*#__PURE__*/_jsx(Link,{to:\"/signin\",children:\"Sign In\"}),\" to write a review\"]})})]})]});}","map":{"version":3,"sources":["/home/carlos/Documents/GitHub/mern-ecommerce/frontend/src/screens/ProductScreen.js"],"names":["Axios","React","useContext","useEffect","useReducer","useRef","useState","Button","Form","FloatingLabel","Row","Col","Card","ListGroup","Link","useNavigate","useParams","toast","LoadingBox","MessageBox","Rating","Store","getError","Helmet","reducer","state","action","type","product","payload","loading","error","loadingCreateReview","ProductScreen","reviewsRef","ctxDispatch","dispatch","cart","userInfo","navigate","params","slug","id","rating","setRating","comment","setComment","fetchData","get","data","addToCartHandler","existItem","cartItems","find","x","_id","quantity","countInStock","window","alert","submitHandler","e","preventDefault","post","name","headers","Authorization","token","success","reviews","unshift","review","numReviews","scrollTo","behavior","top","current","offsetTop","image","price","description","seller","length","map","createdAt","substring","target","value"],"mappings":"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","sourcesContent":["import Axios from 'axios';\nimport React, {\n  useContext,\n  useEffect,\n  useReducer,\n  useRef,\n  useState,\n} from 'react';\nimport Button from 'react-bootstrap/Button';\nimport Form from 'react-bootstrap/Form';\nimport FloatingLabel from 'react-bootstrap/FloatingLabel';\nimport Row from 'react-bootstrap/Row';\nimport Col from 'react-bootstrap/Col';\nimport Card from 'react-bootstrap/Card';\nimport ListGroup from 'react-bootstrap/ListGroup';\nimport { Link, useNavigate, useParams } from 'react-router-dom';\nimport { toast } from 'react-toastify';\nimport LoadingBox from '../components/LoadingBox';\nimport MessageBox from '../components/MessageBox';\nimport Rating from '../components/Rating';\nimport { Store } from '../Store';\nimport { getError } from '../utils';\nimport { Helmet } from 'react-helmet-async';\n\nconst reducer = (state, action) => {\n  switch (action.type) {\n    case 'REFRESH_PRODUCT':\n      return { ...state, product: action.payload };\n    case 'FETCH_REQUEST':\n      return { ...state, loading: true };\n    case 'FETCH_SUCCESS':\n      return { ...state, product: action.payload, loading: false };\n    case 'FETCH_FAIL':\n      return { ...state, loading: false, error: action.payload };\n    case 'CREATE_REQUEST':\n      return { ...state, loadingCreateReview: true };\n    case 'CREATE_SUCCESS':\n      return { ...state, loadingCreateReview: false };\n    case 'CREATE_FAIL':\n      return { ...state, loadingCreateReview: false };\n    default:\n      return state;\n  }\n};\n\nexport default function ProductScreen() {\n  let reviewsRef = useRef();\n\n  // to add a item to the cart, i need to dispatch an action on the react context\n  \n  // Get the context\n  // Rename dispatch to 'ctxDispatch' - context dispatch\n  // by using useContext we can have access to the state of the context\n  // and change the context\n  const { state, dispatch: ctxDispatch } = useContext(Store);\n\n  const { cart, userInfo } = state;\n  const [{ loading, error, product, loadingCreateReview }, dispatch] =\n    useReducer(reducer, {\n      loading: true,\n      error: '',\n    });\n\n  const navigate = useNavigate();\n\n  const params = useParams();\n  const { id: slug } = params;\n\n  const [rating, setRating] = useState(0);\n  const [comment, setComment] = useState('');\n\n  useEffect(() => {\n    const fetchData = async () => {\n      dispatch({ type: 'FETCH_REQUEST' });\n      try {\n        const { data } = await Axios.get(`/api/products/slug/${slug}`);\n        dispatch({ type: 'FETCH_SUCCESS', payload: data });\n      } catch (error) {\n        dispatch({\n          type: 'FETCH_FAIL',\n          payload: getError(error),\n        });\n      }\n    };\n\n    fetchData();\n  }, [dispatch, slug]);\n\n  // add item to the cart\n  const addToCartHandler = async () => {\n    // exist item\n    const existItem = cart.cartItems.find((x) => x._id === product._id);\n\n    // quantity\n    const quantity = existItem ? existItem.quantity + 1 : 1;\n\n    // ajax request to get data product\n    const { data } = await Axios.get(`/api/products/${product._id}`);\n\n    //\n    if (data.countInStock < quantity) {\n      window.alert('Sorry. Product is out of stock');\n      return;\n    }\n    // dispatch action \n    // payload - pass the product and the quantity\n    ctxDispatch({ type: 'CART_ADD_ITEM', payload: { ...product, quantity } });\n    navigate('/cart');\n  };\n\n  const submitHandler = async (e) => {\n    e.preventDefault();\n    if (!comment || !rating) {\n      toast.error('Please enter comment and rating');\n      return;\n    }\n    dispatch({ type: 'CREATE_REQUEST' });\n    try {\n      const { data } = await Axios.post(\n        `/api/products/${product._id}/reviews`,\n        { rating, comment, name: userInfo.name },\n        {\n          headers: { Authorization: `Bearer ${userInfo.token}` },\n        }\n      );\n      dispatch({\n        type: 'CREATE_SUCCESS',\n      });\n      toast.success('Review submitted successfully');\n      product.reviews.unshift(data.review);\n      product.numReviews = data.numReviews;\n      product.rating = data.rating;\n      dispatch({ type: 'REFRESH_PRODUCT', payload: product });\n      window.scrollTo({\n        behavior: 'smooth',\n        top: reviewsRef.current.offsetTop,\n      });\n    } catch (error) {\n      toast.error(getError(error));\n      dispatch({ type: 'CREATE_FAIL' });\n    }\n  };\n  \n  return loading ? (\n    <LoadingBox></LoadingBox>\n  ) : error ? (\n    <MessageBox variant=\"danger\">{error}</MessageBox>\n  ) : (\n    <div>\n      <Row>\n        <Col md={6}>\n          <img\n            className=\"img-large\"\n            src={product.image}\n            alt={product.name}\n          ></img>\n        </Col>\n        <Col md={3}>\n          <ListGroup variant=\"flush\">\n            <ListGroup.Item>\n              <Helmet>\n                <title>{product.name}</title>\n              </Helmet>\n              <h1>{product.name}</h1>\n            </ListGroup.Item>\n            <ListGroup.Item>\n              <Rating\n                rating={product.rating}\n                numReviews={product.numReviews}\n              ></Rating>\n            </ListGroup.Item>\n            <ListGroup.Item>Pirce : ${product.price}</ListGroup.Item>\n            <ListGroup.Item>\n              Description:\n              <p>{product.description}</p>\n            </ListGroup.Item>\n          </ListGroup>\n        </Col>\n        <Col md={3}>\n          <Card>\n            <Card.Body>\n              <ListGroup variant=\"flush\">\n                <ListGroup.Item>\n                  Seller{' '}\n                  <h2>\n                    <Link to={`/seller/${product.seller._id}`}>\n                      {product.seller.seller.name}\n                    </Link>\n                  </h2>\n                  <Rating\n                    rating={product.seller.seller.rating}\n                    numReviews={product.seller.seller.numReviews}\n                  ></Rating>\n                </ListGroup.Item>\n                <ListGroup.Item>\n                  <Row>\n                    <Col>Pirce:</Col>\n                    <Col>${product.price}</Col>\n                  </Row>\n                </ListGroup.Item>\n                <ListGroup.Item>\n                  <Row>\n                    <Col>Status:</Col>\n                    <Col>\n                      {product.countInStock > 0 ? (\n                        <span className=\"success\">In Stock</span>\n                      ) : (\n                        <span className=\"danger\">Unavailable</span>\n                      )}\n                    </Col>\n                  </Row>\n                </ListGroup.Item>\n\n                {product.countInStock > 0 && (\n                  <ListGroup.Item>\n                    <div className=\"d-grid\">\n                      <Button onClick={addToCartHandler} variant=\"primary\">\n                        Add to Cart\n                      </Button>\n                    </div>\n                  </ListGroup.Item>\n                )}\n              </ListGroup>\n            </Card.Body>\n          </Card>\n        </Col>\n      </Row>\n      <div className=\"my-3\">\n        <h2 ref={reviewsRef}>Reviews</h2>\n\n        <div className=\"mb-3\">\n          {product.reviews.length === 0 && (\n            <MessageBox>There is no review</MessageBox>\n          )}\n        </div>\n        <ListGroup>\n          {product.reviews.map((review) => (\n            <ListGroup.Item key={review._id}>\n              <strong>{review.name}</strong>\n              <Rating rating={review.rating} caption=\" \"></Rating>\n              <p>{review.createdAt.substring(0, 10)}</p>\n              <p>{review.comment}</p>\n            </ListGroup.Item>\n          ))}\n        </ListGroup>\n        <div className=\"my-3\">\n          {userInfo ? (\n            <form onSubmit={submitHandler}>\n              <h2>Write a customer review</h2>\n\n              <Form.Group className=\"mb-3\" controlId=\"rating\">\n                <Form.Label>Rating</Form.Label>\n                <Form.Select\n                  aria-label=\"Rating\"\n                  value={rating}\n                  onChange={(e) => setRating(e.target.value)}\n                >\n                  <option value=\"\">Select...</option>\n                  <option value=\"1\">1- Poor</option>\n                  <option value=\"2\">2- Fair</option>\n                  <option value=\"3\">3- Good</option>\n                  <option value=\"4\">4- Very good</option>\n                  <option value=\"5\">5- Excelent</option>\n                </Form.Select>\n              </Form.Group>\n\n              <FloatingLabel\n                controlId=\"floatingTextarea\"\n                label=\"Comments\"\n                className=\"mb-3\"\n              >\n                <Form.Control\n                  as=\"textarea\"\n                  placeholder=\"Leave a comment here\"\n                  value={comment}\n                  onChange={(e) => setComment(e.target.value)}\n                />\n              </FloatingLabel>\n\n              <div className=\"mb-3\">\n                <Button disabled={loadingCreateReview} type=\"submit\">\n                  Submit\n                </Button>\n\n                {loadingCreateReview && <LoadingBox></LoadingBox>}\n              </div>\n            </form>\n          ) : (\n            <MessageBox>\n              Please <Link to=\"/signin\">Sign In</Link> to write a review\n            </MessageBox>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}